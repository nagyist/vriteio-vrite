---
import { DefaultLayout } from "#components/layouts";
import { useContentSource } from "vrite:pages";

let { slug } = Astro.params;
let { contentMetadata, group } = Astro.props;

if (slug === undefined) {
  return Astro.redirect("/getting-started/introduction");
}

const contentSource = useContentSource(Astro);
const { Content, headings } = await contentSource.renderContent(slug, group);

export const prerender = true;
export async function getStaticPaths() {
  const contentSource = useContentSource(Astro);
  if ("groups" in contentSource.config) {
    const groupNames = Object.keys(contentSource.config.groups);
    const output = [];

    for await (const group of groupNames) {
      const { contentMetadata } = await contentSource.listContentMetadata("all", undefined, group);

      output.push(
        ...contentMetadata.map((contentMetadata) => {
          return {
            params: {
              slug: contentMetadata.slug
            },
            props: { contentMetadata, group }
          };
        })
      );
    }

    return output;
  }
  const { contentMetadata } = await contentSource.listContentMetadata("all", undefined);

  return contentMetadata.map((contentMetadata) => {
    return {
      params: {
        slug: contentMetadata.slug
      },
      props: { contentMetadata, group: undefined }
    };
  });
}
---

<DefaultLayout
  headings={headings}
  title={contentMetadata.title || ""}
  description={contentMetadata.description}
  hideTOC={group === "api"}
  group={group}
>
  <Content />
</DefaultLayout>
